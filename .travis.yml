language: python
python:
  - "2.7"
  - "3.4"
sudo: true
addons:
  apt:
    packages:
        - libatlas-dev 
        - libatlas-base-dev 
        - liblapack-dev
        - libproj-dev
        - gfortran
        - gdal-bin
        - libgdal1-dev
install:
  # Build pdsinfo and add it to the path.
  - mkdir pdstools
  - pushd pdstools
  - travis_retry wget https://raw.githubusercontent.com/GeoscienceAustralia/pds-tools/988b0b6e8495f9224c384ec0ac4c720c054d022c/pdsinfo.c
  - clang -O pdsinfo.c -lm -o pdsinfo
  - export PATH="$(pwd):${PATH}"
  - popd
  # Expand include path for building python-gdal bindings.
  - export CPLUS_INCLUDE_PATH="/usr/include/gdal"
  - export C_INCLUDE_PATH="/usr/include/gdal"
  # GDAL python version must match system libgdal version.
  - travis_retry pip install pylint pytest-cov pep8 coveralls GDAL==1.10.0 hypothesis==1.12.0
  - travis_retry pip install -r requirements.txt
script: 
    - pep8 eodatasets --max-line-length 120
    - pylint eodatasets --reports no
    # We only count unit test coverage, not integration test coverage.
    # Unit tests.
    - py.test --cov eodatasets eodatasets tests --runslow -m 'not slow'
    # Integration tests.
    - py.test eodatasets tests --runslow -m 'slow'
cache: apt
after_success:
  coveralls
